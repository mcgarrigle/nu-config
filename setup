#!/usr/bin/env nu

def copy-to [ dir ] {
  let files = collect
  mkdir $dir
  $files | each { |file| 
    print $"copy ($file.name) ($dir)"
    cp $file.name $dir
  }
}

# -------------------------------------------------

# copy config and scripts

let autoload_dir = $nu.user-autoload-dirs.0
let scripts_dir  = $nu.default-config-dir | path join "scripts"

ls autoload | copy-to $autoload_dir
ls config   | copy-to $nu.default-config-dir
ls scripts  | copy-to $scripts_dir

# install plugins

/usr/libexec/nushell/post-install.nu

# install carapace completions

mkdir $nu.cache-dir

$env.CARAPACE_BRIDGES = 'zsh,fish,bash,inshellisense' # optional
carapace _carapace nushell | save --force $"($nu.cache-dir)/carapace.nu"

null
